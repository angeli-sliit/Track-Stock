<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ include file="../Dashboard/headeradmin.jsp" %>
<%@ page import="java.sql.Connection, java.sql.PreparedStatement, java.sql.ResultSet, java.sql.SQLException" %>
<%@ page import="auth.DbConn" %>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Track-Stock - User Management</title>
</head>
<body>
<div class="page">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12"></div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading clearfix">
                        <strong>
                            <span class="glyphicon glyphicon-th"></span>
                            <span>Groups</span>
                        </strong>
                        <a href="add_group.php" class="btn btn-info pull-right btn-sm"> Add New Group</a>
                    </div>
                    <div class="panel-body">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th class="text-center" style="width: 50px;">#</th>
                                    <th>Name</th>
                                    <th class="text-center" style="width: 20%;">Access Level</th>
                                    <th class="text-center" style="width: 15%;">Status</th>
                                    <th class="text-center" style="width: 100px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody>

                                <!-- Dynamically Loaded Groups -->
                                <%
                                    try (Connection conn = DbConn.getConnection();
                                         PreparedStatement pstmt = conn.prepareStatement("SELECT email, Access_level, Access_state FROM registered_user");
                                         ResultSet rs = pstmt.executeQuery()) {
                                        
                                        int counter = 1;  // Row counter for dynamically generated rows

                                        while (rs.next()) {
                                        	String UserID = rs.getString("UserID");
                                            String email = rs.getString("email");
                                            int accessLevel = rs.getInt("Access_level");
                                            String status = rs.getString("Access_state").equals("Active") ? "Active" : "Deactive";
                                            String labelClass = status.equals("Active") ? "label-success" : "label-danger";
                                %>
                                <tr>
                                    <td class="text-center"><%= counter %></td>
                                    <td><%= email %></td>
                                    <td class="text-center"><%= accessLevel %></td>
                                    <td class="text-center"><span class="label <%= labelClass %>"><%= status %></span></td>
                                    <td class="text-center">
                                        <div class="btn-group">
                                            <a href="edit_group.php?id=<%= email %>" class="btn btn-xs btn-warning" data-toggle="tooltip" title="Edit">
                                                <i class="glyphicon glyphicon-pencil"></i>
                                            </a>
                                            <a href="delete_group.php?id=<%= counter %>" class="btn btn-xs btn-danger" data-toggle="tooltip" title="Remove">
                                                <i class="glyphicon glyphicon-remove"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                                <%
                                            counter++;  // Increment row counter for next iteration
                                        }

                                    } catch (SQLException | ClassNotFoundException e) {
                                        e.printStackTrace();
                                    }
                                %>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
