<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ include file="../Dashboard/headeradmin.jsp" %>
<%@ page import="java.sql.Connection, java.sql.PreparedStatement, java.sql.ResultSet, java.sql.SQLException" %>
<%@ page import="auth.DbConn" %>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Track-Stock - User Management</title>
</head>
<body>
<div class="page">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12"></div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading clearfix">
                        <strong>
                            <span class="glyphicon glyphicon-th"></span>
                            <span>Groups</span>
                        </strong>
                        <a href="add_group.php" class="btn btn-info pull-right btn-sm"> Add New Group</a>
                    </div>
                    <div class="panel-body">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th class="text-center" style="width: 50px;">#</th>
                                    <th>Name</th>
                                    <th class="text-center" style="width: 20%;">Access Level</th>
                                    <th class="text-center" style="width: 15%;">Status</th>
                                    <th class="text-center" style="width: 100px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody>

                              <!-- Dynamically Loaded Groups -->
<%
    try (Connection conn = DbConn.getConnection();
         PreparedStatement pstmt = conn.prepareStatement("SELECT UserID, email, Access_level, Access_state FROM registered_user");
         ResultSet rs = pstmt.executeQuery()) {
        
        int counter = 1;  // Initialize row counter

        while (rs.next()) {
            String userID = rs.getString("UserID");  // Fetch UserID
            String email = rs.getString("email");    // Fetch email
            int accessLevel = rs.getInt("Access_level");  // Fetch Access Level
            String accessPosition = "";

            // Determine the position based on Access Level
            switch(accessLevel) {
                case 3:
                    accessPosition = "User";
                    break;
                case 2:
                    accessPosition = "Special";
                    break;
                case 1:
                    accessPosition = "Admin";
                    break;
            }

            String status = rs.getString("Access_state").equals("Active") ? "Active" : "Deactive";  // Determine status
            String labelClass = status.equals("Active") ? "label-success" : "label-danger";  // Choose CSS class for status
%>
<tr>
    <td class="text-center"><%= counter %></td>  <!-- Display counter -->
    <td><%= email %></td>  <!-- Display email -->
    <td class="text-center"><%= accessPosition %></td>  <!-- Display Access Position -->
    <td class="text-center">
        <span class="label <%= labelClass %>"><%= status %></span>  <!-- Display status with dynamic label -->
    </td>
    <td class="text-center">
        <div class="btn-group">
            <a href="edit_group.php?id=<%= userID %>" class="btn btn-xs btn-warning" data-toggle="tooltip" title="Edit">
                <i class="glyphicon glyphicon-pencil"></i>
            </a>
            <a href="delete_group.php?id=<%= userID %>" class="btn btn-xs btn-danger" data-toggle="tooltip" title="Remove">
                <i class="glyphicon glyphicon-remove"></i>
            </a>
        </div>
    </td>
</tr>
<%
            counter++;  // Increment row counter
        }

    } catch (SQLException | ClassNotFoundException e) {
        e.printStackTrace();  // Print any SQL or ClassNotFound exceptions
    }
%>
                              
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
